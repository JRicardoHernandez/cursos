var g_bShowApiErrors=!1,g_bInitializeOnLoad=!0,g_strAPINotFound="Management system interface not found.",g_strAPITooDeep="Cannot find API - too deeply nested.",g_strAPIInitFailed="Found API but LMSInitialize failed.",g_strAPISetError="Trying to set value but API not available.",g_strFSAPIError='LMS API adapter returned error code: "%1"\nWhen FScommand called API.%2\nwith "%3"',g_strDisableErrorMsgs="Select cancel to disable future warnings.",g_bSetCompletedAutomatically=!1,g_SCO_MasteryScore=null,g_nSCO_ScoreMin=0,g_nSCO_ScoreMax=100,g_bInterpretMasteryScore=!1,g_nFindAPITries=0,g_objAPI=null,g_bInitDone=!1,g_bFinishDone=!1,g_bSCOBrowse=!1,g_dtmInitialized=new Date,g_bMasteryScoreInitialized=!1,g_varInterval="",g_intIntervalSecs=3,g_intPollSecs=.25,g_intCurrentTime=(new Date).getTime();function AlertUserOfAPIError(e){g_bShowApiErrors&&(confirm(e+"\n\n"+g_strDisableErrorMsgs)||(g_bShowApiErrors=!1))}function ExpandString(e){var t=new RegExp("%","g");for(i=arguments.length-1;i>0;i--)s2="%"+i,e.indexOf(s2)>-1&&(t.compile(s2,"g"),e=e.replace(t,arguments[i]));return e}function FindAPI(e){for(;null==e.API&&null!=e.parent&&e.parent!=e;){if(++g_nFindAPITries>500)return AlertUserOfAPIError(g_strAPITooDeep),null;e=e.parent}return e.API}function waitForAPI(){((new Date).getTime()>g_intCurrentTime+1e3*g_intIntervalSecs||APIOK())&&(clearInterval(g_varInterval),APIOK()?g_bInitializeOnLoad&&SCOInitialize():g_objAPI=null)}function APIOK(){return void 0!==g_objAPI&&null!=g_objAPI}function SCOInitialize(){var e=!0;return g_bInitDone||(window.parent&&window.parent!=window&&(g_objAPI=FindAPI(window.parent)),null==g_objAPI&&null!=window.opener&&(g_objAPI=FindAPI(window.opener)),APIOK()?"true"==(e=g_objAPI.LMSInitialize(""))?(g_bInitDone=!0,(g_bSCOBrowse="browse"==g_objAPI.LMSGetValue("cmi.core.lesson_mode"))||"not attempted"==g_objAPI.LMSGetValue("cmi.core.lesson_status")&&(e=g_objAPI.LMSSetValue("cmi.core.lesson_status","incomplete"))):AlertUserOfAPIError(g_strAPIInitFailed):(AlertUserOfAPIError(g_strAPINotFound),e=!1),"undefined"!=typeof SCOInitData&&parent.SCOInitData(),g_dtmInitialized=new Date),e+""}function SCOFinish(){return APIOK()&&0==g_bFinishDone&&(SCOReportSessionTime(),g_bSetCompletedAutomatically&&SCOSetStatusCompleted(),"undefined"!=typeof SCOSaveData&&SCOSaveData(),g_bFinishDone="true"==g_objAPI.LMSFinish("")),g_bFinishDone+""}function SCOGetValue(e){return APIOK()?g_objAPI.LMSGetValue(e.toString()):""}function SCOCommit(){return APIOK()?g_objAPI.LMSCommit(""):"false"}function SCOGetLastError(){return APIOK()?g_objAPI.LMSGetLastError():"-1"}function SCOGetErrorString(e){return APIOK()?g_objAPI.LMSGetErrorString(e):"No API"}function SCOGetDiagnostic(e){return APIOK()?g_objAPI.LMSGetDiagnostic(e):"No API"}var g_bMinScoreAcquired=!1,g_bMaxScoreAcquired=!1;function SCOSetValue(e,t){var r="";return APIOK()?"cmi.core.score.raw"==e&&(r=privReportRawScore(t)):(AlertUserOfAPIError(g_strAPISetError+"\n"+e+"\n"+t),r="false"),""==r&&"true"!=(r=g_objAPI.LMSSetValue(e,t.toString()+""))?r:("cmi.core.score.min"==e?(g_bMinScoreAcquired=!0,g_nSCO_ScoreMin=t):"cmi.core.score.max"==e&&(g_bMaxScoreAcquired=!0,g_nSCO_ScoreMax=t),r)}function privReportRawScore(e){if(isNaN(e))return"false";if(!g_bMinScoreAcquired&&"true"!=g_objAPI.LMSSetValue("cmi.core.score.min",g_nSCO_ScoreMin+""))return"false";if(!g_bMaxScoreAcquired&&"true"!=g_objAPI.LMSSetValue("cmi.core.score.max",g_nSCO_ScoreMax+""))return"false";if("true"!=g_objAPI.LMSSetValue("cmi.core.score.raw",e))return"false";if(g_bMinScoreAcquired=!1,g_bMaxScoreAcquired=!1,!g_bMasteryScoreInitialized){var t=parseInt(SCOGetValue("cmi.student_data.mastery_score"),10);isNaN(t)||(g_SCO_MasteryScore=t)}if(g_bInterpretMasteryScore&&!isNaN(g_SCO_MasteryScore)&&"true"!=SCOSetValue("cmi.core.lesson_status",e>=g_SCO_MasteryScore?"passed":"failed"))return"false";return"true"}function MillisecondsToCMIDuration(e){var t="",r=new Date;r.setTime(e);var n="000"+Math.floor(e/36e5),i="0"+r.getMinutes(),a="0"+r.getSeconds(),o="0"+Math.round(r.getMilliseconds()/10);return t=n.substr(n.length-4)+":"+i.substr(i.length-2)+":",t+=a.substr(a.length-2)+"."+o.substr(o.length-2)}function SCOReportSessionTime(){return SCOSetValue("cmi.core.session_time",MillisecondsToCMIDuration((new Date).getTime()-g_dtmInitialized.getTime()))}function SCOSetStatusCompleted(){var e=SCOGetValue("cmi.core.lesson_status");return"browse"==SCOGetValue("cmi.core.lesson_mode")?"false":"completed"!=e&&"passed"!=e&&"failed"!=e?SCOSetValue("cmi.core.lesson_status","completed"):void 0}function SCOSetObjectiveData(e,t,r){var n="false",i=SCOGetObjectiveIndex(e);return isNaN(i)?(i=parseInt(SCOGetValue("cmi.objectives._count")),isNaN(i)&&(i=0),"true"==SCOSetValue("cmi.objectives."+i+".id",e)&&(n=SCOSetValue("cmi.objectives."+i+"."+t,r))):"true"!=(n=SCOSetValue("cmi.objectives."+i+"."+t,r))&&(i=parseInt(SCOGetValue("cmi.objectives._count")),isNaN(i)||"true"==SCOSetValue("cmi.objectives."+i+".id",e)&&(n=SCOSetValue("cmi.objectives."+i+"."+t,r))),n}function SCOGetObjectiveData(e,t){var r=SCOGetObjectiveIndex(e);return isNaN(r)?"":SCOGetValue("cmi.objectives."+r+"."+t)}function SCOGetObjectiveIndex(e){var t=-1,r=parseInt(SCOGetValue("cmi.objectives._count"));if(!isNaN(r))for(t=r-1;t>=0;t--)if(SCOGetValue("cmi.objectives."+t+".id")==e)return t;return NaN}function AICCTokenToSCORMToken(e,t){var r=e.split(","),n=t.substr(0,1).toLowerCase();for(i=0;i<r.length;i++)if(n==r[i].substr(0,1))return r[i];return t}function normalizeStatus(e){return AICCTokenToSCORMToken("completed,incomplete,not attempted,failed,passed",e)}function normalizeInteractionType(e){return AICCTokenToSCORMToken("true-false,choice,fill-in,matching,performance,sequencing,likert,numeric",e="other"==e?"choice":e)}function normalizeInteractionResult(e){return AICCTokenToSCORMToken("correct,wrong,unanticipated,neutral",e="incorrect"==e?"wrong":e)}function formatTimestamp(e){return formatTime(e,void 0,void 0,2)}function formatTime(e,t,r,n){var i,a,o;if(i="0",void 0==e)a=(s=new Date).getHours(),t=s.getMinutes(),r=s.getSeconds();else if("string"==typeof e&&e.indexOf(":")>-1){var s;a=(s=e.split(":"))[0],t=s[1],r=s[2]}else i="0",r="0",t="0",a="0",(r=Math.round(e))>59&&(r-=60*(t=Math.round(r/60))),t>59&&(t-=60*(a=Math.round(t/60))),a>23&&(a-=24*(i=Math.round(a/24)));return void 0==n||1==n?(o="P","0"!=i&&(o+=i+"D"),o+="T"+a+"H"+t+"M"+r+"S"):o=formatNum(a,2)+":"+formatNum(t,2)+":"+formatNum(r,2),o}function formatDate(e,t,r){if(void 0==e)e=formatNum((n=new Date).getMonth()+1,2),t=formatNum(n.getDate(),2),r=n.getFullYear();else if("string"==typeof e&&e.indexOf("/")>-1){var n;e=formatNum((n=e.split("/"))[0],2),t=formatNum(n[1],2),r=formatNum(n[2],4)}return r+"-"+e+"-"+t}function formatNum(e,t){var r="",n=0,i=e.toString();if(i.length>t);else for(n=1;n<=t-i.length;n++)r+="0";return r+=e}var g_bIsInternetExplorer=-1!=navigator.appName.indexOf("Microsoft");function nswf_DoFSCommand(command,args){var nswfObj=g_bIsInternetExplorer?nswf:document.nswf,myArgs=new String(args),cmd=new String(command),v="",err="true",arg1,arg2,n,s,i,sep=myArgs.indexOf(",");if(sep>-1?(arg1=myArgs.substr(0,sep),arg2=myArgs.substr(sep+1)):arg1=myArgs,APIOK()){if("LMS"==cmd.substring(0,3))"LMSInitialize"==cmd?err=APIOK()+"":"LMSSetValue"==cmd?err=SCOSetValue(arg1,arg2):"LMSFinish"==cmd?err=SCOFinish():"LMSCommit"==cmd?err=SCOCommit():"LMSFlush"==cmd||(arg2&&arg2.length>0?"LMSGetValue"==cmd?nswfObj.SetVariable(arg2,SCOGetValue(arg1)):"LMSGetLastError"==cmd?nswfObj.SetVariable(arg2,SCOGetLastError(arg1)):"LMSGetErrorString"==cmd?nswfObj.SetVariable(arg2,SCOGetLastError(arg1)):"LMSGetDiagnostic"==cmd?nswfObj.SetVariable(arg2,SCOGetDiagnostic(arg1)):(v=eval("g_objAPI."+cmd+'("'+arg1+'")'),nswfObj.SetVariable(arg2,v)):"LMSGet"==cmd.substring(0,3)&&(err="-2: No Flash variable specified"));else if("MM_cmi"==cmd.substring(0,6)||"CMISet"==cmd.substring(0,6)){var F_intData=myArgs.split(";");if("MM_cmiSendInteractionInfo"==cmd){if(n=SCOGetValue("cmi.interactions._count"),s="cmi.interactions."+n+".",v=F_intData[2],null!=v&&""!=v||(err=201),"true"==err&&(err=SCOSetValue(s+"id",v)),"true"==err){var re=new RegExp("[{}]","g");for(i=1;i<9&&"true"==err;i++)v=F_intData[i],null!=v&&""!=v&&(1==i?err=SCOSetValue(s+"time",v):3==i?err=SCOSetValue(s+"objectives.0.id",v):4==i?err=SCOSetValue(s+"type",normalizeInteractionType(v)):5==i?(v=v.replace(re,""),err=SCOSetValue(s+"correct_responses.0.pattern",v)):6==i?(v=v.replace(re,""),err=SCOSetValue(s+"student_response",v)):7==i?err=SCOSetValue(s+"result",normalizeInteractionResult(v)):8==i?err=SCOSetValue(s+"weighting",v):9==i&&(err=SCOSetValue(s+"latency",v)))}}else"MM_cmiSendObjectiveInfo"==cmd?(err=SCOSetObjectiveData(F_intData[1],".score.raw",F_intData[2]),"true"==err&&SCOSetObjectiveData(F_intData[1],".status",normalizeStatus(F_intData[3]))):"CMISetScore"==cmd||"MM_cmiSendScore"==cmd?err=SCOSetValue("cmi.core.score.raw",F_intData[0]):"CMISetStatus"==cmd||"MM_cmiSetLessonStatus"==cmd?err=SCOSetValue("cmi.core.lesson_status",normalizeStatus(F_intData[0])):"CMISetTime"==cmd?err=SCOSetValue("cmi.core.session_time",F_intData[0]):"CMISetCompleted"==cmd?err=SCOSetStatusCompleted():"CMISetStarted"==cmd?err=SCOSetValue("cmi.core.lesson_status","incomplete"):"CMISetPassed"==cmd?err=SCOSetValue("cmi.core.lesson_status","passed"):"CMISetFailed"==cmd?err=SCOSetValue("cmi.core.lesson_status","failed"):"CMISetData"==cmd?err=SCOSetValue("cmi.suspend_data",F_intData[0]):"CMISetLocation"==cmd?err=SCOSetValue("cmi.core.lesson_location",F_intData[0]):"CMISetTimedOut"==cmd&&(err=SCOSetValue("cmi.core.exit","time-out"))}else"CMIFinish"==cmd||"CMIExitAU"==cmd?err=SCOFinish():"CMIInitialize"==cmd||"MM_StartSession"==cmd?err=SCOInitialize():eval("g_objAPI."+cmd)?(v=eval("g_objAPI."+cmd+'("'+arg1+'")'),arg2&&arg2.length>0?nswfObj.SetVariable(arg2,v):err=v):err="false";return g_bShowApiErrors&&"true"!=err&&AlertUserOfAPIError(ExpandString(g_strFSAPIError,err,cmd,args)),err}}function checkInteractionResponse(e){for(var t="",r=0;r<e.length;r++)("."==e.substr(r,1)||","==e.substr(r,1))&&"["!=e.substr(r-1,1)&&"]"!=e.substr(r+1,1)?t+="["+e.substr(r,1)+"]":t+=e.substr(r,1);return t=""==t?"0":t}